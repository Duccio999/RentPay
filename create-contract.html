<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Crea nuovo contratto (DEMO) â€” RentPay</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<nav class="rp-nav">
  <a class="rp-brand" href="./index.html"><span class="rp-house">ğŸ </span><span class="rp-brand-text">RentPay</span></a>
  <div class="rp-menu-desktop">
    <a href="dashboard-prop.html">Dashboard</a>
    <a class="rp-accent" href="login.html">Cambia account</a>
  </div>
  <button id="rpHamburger" class="rp-hamburger" aria-label="Apri menu">â˜°</button>
</nav>
<aside id="rpDrawer" class="rp-drawer" aria-hidden="true">
  <div class="rp-drawer-head"><span>MenÃ¹</span><button id="rpDrawerClose" class="rp-close">Ã—</button></div>
  <a href="dashboard-prop.html">Dashboard</a>
  <a class="rp-accent" href="login.html">Cambia account</a>
</aside><div id="rpBackdrop" class="rp-backdrop" hidden></div>

<main class="container narrow">
  <section class="hero card">
    <h1>Crea nuovo contratto</h1>
    <p class="lead">Compila e invia allâ€™inquilino per la firma digitale. (DEMO)</p>
  </section>

  <div class="form-card">
    <div class="field">
      <label>Proprietario</label>
      <div class="input"><span>ğŸ‘¤</span><input id="owner" readonly></div>
    </div>

    <div class="field" style="margin-top:10px">
      <label>Inquilino</label>
      <div class="input"><span>ğŸ¡</span>
        <select id="tenantSel"></select>
      </div>
    </div>

    <div class="field" style="margin-top:10px">
      <label>Indirizzo immobile</label>
      <div class="input"><span>ğŸ“</span><input id="address" placeholder="Via..."></div>
    </div>

    <div class="grid" style="margin-top:10px">
      <div class="field">
        <label>Canone mensile (â‚¬)</label>
        <div class="input"><span>ğŸ’¶</span><input id="rent" type="number" min="0" step="1"></div>
      </div>
      <div class="field">
        <label>Data inizio</label>
        <div class="input"><span>ğŸ“…</span><input id="start" type="date"></div>
      </div>
      <div class="field">
        <label>Durata (mesi)</label>
        <div class="input"><span>ğŸ•’</span><input id="months" type="number" min="1" step="1" value="12"></div>
      </div>
    </div>

    <div class="actions" style="margin-top:14px">
      <button class="btn primary" id="btnSend">Firma & invia (DEMO)</button>
    </div>
  </div>
</main>

<footer class="footer container">
  <div class="f-links"><a href="terms.html">Termini</a><a href="privacy.html">Privacy</a><a href="cookie.html">Cookie</a></div>
  <div class="copy">Â© 2025 RentPay â€” PWA</div>
</footer>

<script src="rp-store.js"></script>
<script>
// nav mobile
(function(){const b=rpHamburger,d=rpDrawer,x=rpDrawerClose,o=rpBackdrop;function open(){d.classList.add('open');o.hidden=false;o.classList.add('show');document.body.style.overflow='hidden'}function close(){d.classList.remove('open');o.classList.remove('show');o.hidden=true;document.body.style.overflow=''}b&&b.addEventListener('click',open);x&&x.addEventListener('click',close);o&&o.addEventListener('click',close);window.addEventListener('keydown',e=>{if(e.key==='Escape')close()});})();

const me = RP.me();
if(!me || me.role!=='landlord'){ location.href='login.html'; }

// UI refs
owner.value = `${me.name} â€” ${me.email}`;
const tenants = RP.users.tenants();
tenants.forEach(t=>{
  const opt = document.createElement('option');
  opt.value = t.id;
  opt.textContent = `${t.name} â€” ${t.email}`;
  tenantSel.appendChild(opt);
});

// precompila con primo inquilino
(function preset(){
  const t = tenants[0];
  tenantSel.value = t?.id || '';
  address.value = t?.address || '';
  rent.value    = t?.rent ?? '';
  start.value   = new Date().toISOString().slice(0,10);
})();

tenantSel.addEventListener('change', ()=>{
  const t = tenants.find(x=>x.id===tenantSel.value);
  if(!t) return;
  address.value = t.address || '';
  rent.value    = t.rent ?? '';
});

btnSend.addEventListener('click', ()=>{
  const payload = {
    landlordId: me.id,
    tenantId: tenantSel.value,
    address: address.value.trim(),
    rent: Number(rent.value||0),
    start: start.value || new Date().toISOString().slice(0,10),
    months: Number(months.value||12)
  };
  if(!payload.tenantId || !payload.address || !payload.rent){
    alert('Compila inquilino, indirizzo e canone.');
    return;
  }
  RP.contracts.add(payload);
  // torna alla dashboard proprietario
  location.href = 'dashboard-prop.html';
});
</script>
</body>
</html>
