<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dashboard Proprietario — RentPay</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<nav class="rp-nav">
  <a class="rp-brand" href="./index.html"><span class="rp-house">🏠</span><span class="rp-brand-text">RentPay</span></a>
  <div class="rp-menu-desktop">
    <a href="./index.html">Home</a>
    <a href="./vision.html">Visione</a>
    <a href="./funzioni.html">Funzioni</a>
    <a href="./garanzia.html">Garanzia</a>
    <a href="./prezzi.html">Prezzi</a>
    <a href="./firma.html">Firma (demo)</a>
    <a class="rp-accent" href="./login.html">Accedi</a>
  </div>
  <button id="rpHamburger" class="rp-hamburger" aria-label="Apri menu" aria-expanded="false">☰</button>
</nav>
<aside id="rpDrawer" class="rp-drawer" aria-hidden="true">
  <div class="rp-drawer-head"><span class="rp-drawer-title">Menù</span><button id="rpDrawerClose" class="rp-close">×</button></div>
  <a href="./index.html">Home</a>
  <a href="./vision.html">Visione</a>
  <a href="./funzioni.html">Funzioni</a>
  <a href="./garanzia.html">Garanzia</a>
  <a href="./prezzi.html">Prezzi</a>
  <a href="./firma.html">Firma (demo)</a>
  <a class="rp-accent" href="./login.html">Accedi</a>
</aside>
<div id="rpBackdrop" class="rp-backdrop" hidden></div>

<main class="container">
  <section class="hero card">
    <h1>Dashboard Proprietario</h1>
    <p class="lead">Gestisci i contratti e monitora lo stato. Questa è una <b>DEMO</b>: dati e firme non sono vincolanti.</p>
  </section>

  <section class="card">
    <div class="section-head">
      <h2>📑 Contratti in attesa di firma dell’inquilino</h2>
    <a class="btn primary" href="./create-contract.html">Crea nuovo contratto (demo)</a>
    </div>
    <div id="tblPending" class="table-wrap" style="margin-top:8px"></div>
  </section>

  <section class="card">
    <h2>📄 Contratti attivi</h2>
    <div id="tblActive" class="table-wrap" style="margin-top:8px"></div>
  </section>
</main>

<footer class="footer container">
  <div class="f-links">
    <a href="terms.html">Termini di servizio</a>
    <a href="privacy.html">Privacy Policy</a>
    <a href="cookie.html">Cookie Policy</a>
  </div>
  <div class="copy">© <span id="year"></span> RentPay — PWA</div>
</footer>

<script src="app.js"></script>
<script src="rp-store.js"></script>
<script type="text/javascript" data-cookieconsent="ignore">
(function(){
  const btn=document.getElementById('rpHamburger'), d=document.getElementById('rpDrawer'), x=document.getElementById('rpDrawerClose'), b=document.getElementById('rpBackdrop');
  function openD(){d.classList.add('open');b.hidden=false;b.classList.add('show');document.body.style.overflow='hidden'}
  function closeD(){d.classList.remove('open');b.classList.remove('show');b.hidden=true;document.body.style.overflow=''}
  btn&&btn.addEventListener('click',openD); x&&x.addEventListener('click',closeD); b&&b.addEventListener('click',closeD);
  d.querySelectorAll('a').forEach(a=>a.addEventListener('click',closeD));
})();
</script>

<script>
(function renderProp(){
  const me = RP.me();
  if(!me || !/^l/.test(me.id)){ location.href='login.html'; return; }

  const pending = RP.listContracts({landlordId:me.id, status:'pending_tenant'});
  const active  = RP.listContracts({landlordId:me.id, status:'active'});

  function rows(list){
    if(!list.length) return '<div class="small" style="padding:12px">Nessun contratto.</div>';
    return `
      <table class="rp-table">
        <thead><tr>
          <th>Immobile</th><th>Inquilino</th><th>Canone</th><th>Periodo</th><th>Stato</th>
        </tr></thead>
        <tbody>
        ${list.map(c=>{
          const t = RP.userById(c.tenantId)||{};
          const per = \`${new Date(c.start).toLocaleDateString('it-IT')} · ${c.months} mesi\`;
          const can = new Intl.NumberFormat('it-IT',{style:'currency',currency:'EUR'}).format(c.rent);
          const st  = (c.status==='active'?'Attivo':'In attesa firma inquilino');
          return `<tr>
            <td>${c.address||'-'}</td>
            <td>${t.name||'-'}</td>
            <td>${can}</td>
            <td>${per}</td>
            <td>${st}</td>
          </tr>`;
        }).join('')}
        </tbody>
      </table>
    `;
  }

  document.getElementById('tblPending').innerHTML = rows(pending);
  document.getElementById('tblActive').innerHTML  = rows(active);

  // toast semplice quando torni da creazione
  if(new URLSearchParams(location.search).get('sent')==='1'){
    setTimeout(()=>alert('Contratto inviato all’inquilino (demo).'), 300);
  }
})();
</script>
</body>
</html>
