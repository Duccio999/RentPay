<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Accesso Demo — RentPay</title>
  <link rel="stylesheet" href="styles.css?v=fix9">
  <style>
    .stack { display:flex; flex-direction:column; gap:24px }
    .form-card .actions{ justify-content:flex-start }
  </style>
</head>
<body class="auth">
<!-- NAV -->
<nav class="rp-nav">
  <a class="rp-brand" href="./index.html"><span class="rp-house">🏠</span><span class="rp-brand-text">RentPay</span></a>
  <div class="rp-menu-desktop">
    <a href="index.html">Home</a>
    <a href="funzioni.html">Funzioni</a>
    <a href="prezzi.html">Prezzi</a>
    <a class="rp-accent" href="login.html" aria-current="page">Accedi</a>
  </div>
  <button id="rpHamburger" class="rp-hamburger" aria-label="Apri menu">☰</button>
</nav>
<aside id="rpDrawer" class="rp-drawer" aria-hidden="true">
  <div class="rp-drawer-head"><span>Menù</span><button id="rpDrawerClose" class="rp-close">×</button></div>
  <a href="index.html">Home</a>
  <a href="funzioni.html">Funzioni</a>
  <a href="prezzi.html">Prezzi</a>
  <a class="rp-accent" href="login.html">Accedi</a>
</aside>
<div id="rpBackdrop" class="rp-backdrop" hidden></div>

<main class="container narrow stack">
  <section class="hero card">
    <h1>Accesso demo con profili registrati</h1>
    <p class="lead">Scegli il ruolo e un profilo; email e password fittizia per la DEMO.</p>
  </section>

  <!-- toggle ruolo -->
  <div class="role-toggle">
    <button class="pill active" id="btnProp">👤 Proprietario</button>
    <button class="pill" id="btnInq">🏡 Inquilino</button>
  </div>

  <!-- form -->
  <section class="form-card">
    <div class="field">
      <label><strong>Seleziona profilo demo</strong></label>
      <div class="input"><span>📁</span><select id="profileSel"></select></div>
    </div>

    <div class="grid" style="margin-top:12px">
      <div class="field">
        <label>Email</label>
        <div class="input"><span>✉️</span><input id="email" readonly></div>
      </div>
      <div class="field">
        <label>Password (demo)</label>
        <div class="input"><span>🔒</span><input id="pwd" type="password" placeholder="••••••••"></div>
      </div>
    </div>

    <p class="notice" style="margin-top:12px;padding:10px 12px;border-radius:10px">
      <strong>DEMO:</strong> la password non viene verificata né salvata.
    </p>

    <div class="actions" style="margin-top:10px">
      <button class="btn primary" id="btnLogin" type="button">Accedi</button>
    </div>
  </section>
</main>

<footer class="footer container">
  <div class="f-links"><a href="terms.html">Termini</a><a href="privacy.html">Privacy</a><a href="cookie.html">Cookie</a></div>
  <div class="copy">© 2025 RentPay — PWA</div>
</footer>

<!-- Store condiviso -->
<script src="rp-store.js"></script>

<!-- Nav mobile -->
<script>
(function(){
  const b=document.getElementById('rpHamburger'),d=document.getElementById('rpDrawer'),x=document.getElementById('rpDrawerClose'),o=document.getElementById('rpBackdrop');
  function open(){d.classList.add('open');o.hidden=false;o.classList.add('show');document.body.style.overflow='hidden'}
  function close(){d.classList.remove('open');o.classList.remove('show');o.hidden=true;document.body.style.overflow=''}
  b&&b.addEventListener('click',open); x&&x.addEventListener('click',close); o&&o.addEventListener('click',close); window.addEventListener('keydown',e=>{if(e.key==='Escape')close()});
})();
</script>

<!-- Login logic -->
<script>
if(!window.RP){ alert('Errore di caricamento rp-store.js'); }

let ruolo = 'landlord';
const sel    = document.getElementById('profileSel');
const emailI = document.getElementById('email');

function normUser(u){ return { id:u.id, role:u.role||u.ruolo, name:u.name||u.nome, email:u.email }; }
function listForRole(){
  const db = RP.read();
  const list = (ruolo==='landlord') ? db.utenti.proprietari : db.utenti.inquilini;
  return list.map(normUser);
}

function fillOptions(){
  const list = listForRole();
  sel.innerHTML = '';
  list.forEach(u=>{
    const opt = document.createElement('option');
    opt.value = u.id;
    opt.textContent = ${u.name} — ${u.email};
    sel.appendChild(opt);
  });
  sel.selectedIndex = 0;
  showDetail();
}

function showDetail(){
  const u = listForRole().find(x=>x.id===sel.value);
  emailI.value = u ? (u.email || '') : '';
}

document.getElementById('btnProp').onclick = ()=>{
  document.getElementById('btnProp').classList.add('active');
  document.getElementById('btnInq').classList.remove('active');
  ruolo='landlord'; fillOptions();
};
document.getElementById('btnInq').onclick = ()=>{
  document.getElementById('btnInq').classList.add('active');
  document.getElementById('btnProp').classList.remove('active');
  ruolo='tenant'; fillOptions();
};
sel.onchange = showDetail;

document.getElementById('btnLogin').onclick = ()=>{
  if(!sel.value && sel.options.length){ sel.value = sel.options[0].value; }
  const ok = RP.loginById(ruolo, sel.value);
  if(ok){ location.href = (ruolo==='landlord') ? 'dashboard-prop.html' : 'dashboard-inq.html'; }
};

fillOptions();
</script>
</body>
</html>
