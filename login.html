<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Accesso Demo — RentPay</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<nav class="rp-nav">
  <a class="rp-brand" href="./index.html"><span class="rp-house">🏠</span><span class="rp-brand-text">RentPay</span></a>
  <div class="rp-menu-desktop">
    <a href="index.html">Home</a><a href="funzioni.html">Funzioni</a><a href="prezzi.html">Prezzi</a>
    <a class="rp-accent" href="login.html" aria-current="page">Accedi</a>
  </div>
  <button id="rpHamburger" class="rp-hamburger" aria-label="Apri menu">☰</button>
</nav>
<aside id="rpDrawer" class="rp-drawer" aria-hidden="true">
  <div class="rp-drawer-head"><span>Menù</span><button id="rpDrawerClose" class="rp-close">×</button></div>
  <a href="index.html">Home</a><a href="funzioni.html">Funzioni</a><a href="prezzi.html">Prezzi</a>
  <a class="rp-accent" href="login.html">Accedi</a>
</aside><div id="rpBackdrop" class="rp-backdrop" hidden></div>

<main class="container narrow">
  <section class="hero card">
    <h1>Accesso demo con profili registrati</h1>
    <p class="lead">Scegli il ruolo e il profilo: i dati sono già compilati.</p>
  </section>

  <div class="role-toggle">
    <button class="pill active" id="btnProp">👤 Proprietario</button>
    <button class="pill" id="btnInq">🏡 Inquilino</button>
  </div>

  <div class="form-card">
    <div class="field">
      <label><strong>Seleziona profilo demo</strong></label>
      <div class="input"><span>📁</span><select id="profileSel"></select></div>
    </div>

    <div class="grid" style="margin-top:12px">
      <div class="field"><label>Nome e Cognome</label><div class="input"><span>🧑</span><input id="name" readonly></div></div>
      <div class="field"><label>Email</label><div class="input"><span>✉️</span><input id="email" readonly></div></div>
      <div class="field"><label id="lbl1">IBAN (accredito)</label><div class="input"><span>🏦</span><input id="extra1" readonly></div></div>
      <div class="field"><label id="lbl2">Immobili gestiti</label><div class="input"><span>🏢</span><input id="extra2" readonly></div></div>
    </div>

    <p class="notice" style="margin-top:12px;padding:10px 12px;border-radius:10px">
      <strong>DEMO:</strong> i dati sono statici e non vengono salvati.
    </p>

    <div class="actions" style="margin-top:10px">
      <button class="btn primary" id="btnLogin">Accedi</button>
    </div>
  </div>
</main>

<footer class="footer container">
  <div class="f-links"><a href="terms.html">Termini di servizio</a><a href="privacy.html">Privacy</a><a href="cookie.html">Cookie</a></div>
  <div class="copy">© 2025 RentPay — PWA</div>
</footer>

<!-- 1) Store condiviso: deve essere PRIMA della login logic -->
<script src="rp-store.js"></script>

<!-- 2) Nav mobile -->
<script>
(function(){
  const b=document.getElementById('rpHamburger'),d=document.getElementById('rpDrawer'),x=document.getElementById('rpDrawerClose'),o=document.getElementById('rpBackdrop');
  function open(){d.classList.add('open');o.hidden=false;o.classList.add('show');document.body.style.overflow='hidden'}
  function close(){d.classList.remove('open');o.classList.remove('show');o.hidden=true;document.body.style.overflow=''}
  b&&b.addEventListener('click',open); x&&x.addEventListener('click',close); o&&o.addEventListener('click',close); window.addEventListener('keydown',e=>{if(e.key==='Escape')close()});
})();
</script>

<!-- 3) Login logic -->
<script>
if(!window.RP){ alert('Errore di caricamento rp-store.js'); }

let ruolo = 'landlord';
const sel=document.getElementById('profileSel'), nameI=document.getElementById('name'), emailI=document.getElementById('email'),
      ex1=document.getElementById('extra1'), ex2=document.getElementById('extra2'), l1=document.getElementById('lbl1'), l2=document.getElementById('lbl2');

function fillOptions(){
  sel.innerHTML='';
  const list = ruolo==='landlord' ? RP.users.landlords() : RP.users.tenants();
  list.forEach(u=>{
    const opt=document.createElement('option'); opt.value=u.id; opt.textContent=`${u.name} — ${u.email}`; sel.appendChild(opt);
  });
  sel.selectedIndex=0; showDetail();
}
function showDetail(){
  const id = sel.value;
  const u = (ruolo==='landlord' ? RP.users.landlords() : RP.users.tenants()).find(x=>x.id===id);
  if(!u) return;
  nameI.value = u.name; emailI.value = u.email;
  if(ruolo==='landlord'){ l1.textContent='IBAN (accredito)'; l2.textContent='Immobili gestiti'; ex1.value=u.iban||''; ex2.value=u.props??''; }
  else { l1.textContent='Indirizzo'; l2.textContent='Canone mensile (€)'; ex1.value=u.address||''; ex2.value=u.rent??''; }
}
document.getElementById('btnProp').onclick=()=>{document.getElementById('btnProp').classList.add('active');document.getElementById('btnInq').classList.remove('active');ruolo='landlord';fillOptions();}
document.getElementById('btnInq').onclick =()=>{document.getElementById('btnInq').classList.add('active');document.getElementById('btnProp').classList.remove('active');ruolo='tenant';fillOptions();}
sel.onchange=showDetail;

document.getElementById('btnLogin').onclick=()=>{
  const ok = RP.loginById(ruolo, sel.value);
  if(!ok) return;
  location.href = (ruolo==='landlord') ? 'dashboard-prop.html' : 'dashboard-inq.html';
};

fillOptions();
</script>
</body>
</html>
